<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ProductRepositoryAdapter.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">com.mic:jacoco-report-aggregate</a> &gt; <a href="../index.html" class="el_bundle">product</a> &gt; <a href="index.source.html" class="el_package">com.mic.product.infraestructure</a> &gt; <span class="el_source">ProductRepositoryAdapter.java</span></div><h1>ProductRepositoryAdapter.java</h1><pre class="source lang-java linenums">package com.mic.product.infraestructure;


import com.mic.product.application.ProductServiceRepository;
import lombok.AllArgsConstructor;
import lombok.extern.log4j.Log4j2;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Repository;


import java.util.List;

@AllArgsConstructor
<span class="fc" id="L15">@Log4j2</span>
@Repository
public class ProductRepositoryAdapter implements ProductServiceRepository {
<span class="fc" id="L18">    private static final Logger logger = LoggerFactory.getLogger(ProductRepositoryAdapter.class);</span>
    private ProductRepository productRepository;

    @Override
    public ProductEntity createProduct(ProductEntity productEntity) {
<span class="fc" id="L23">        String sku = productEntity.getSku();</span>
        ProductEntity productEntitySave;
<span class="fc" id="L25">        this.logRuntimeStartCreate(sku);</span>
        try {
<span class="fc" id="L27">            productEntitySave = productRepository.save(productEntity);</span>
<span class="fc" id="L28">            this.logExternalSuccessCreate(productEntity);</span>
<span class="fc" id="L29">        } catch (Exception e) {</span>
<span class="fc" id="L30">            this.logExternalFailedCreate(sku, e);</span>
<span class="fc" id="L31">            throw e;</span>
<span class="fc" id="L32">        }</span>
<span class="fc" id="L33">        this.logRuntimeEndCreate();</span>
<span class="fc" id="L34">        return productEntitySave;</span>
    }

    @Override
    public ProductEntity updateProduct(ProductEntity productEntity) {

<span class="fc" id="L40">        String sku = productEntity.getSku();</span>
        ProductEntity productEntityUpdate;
<span class="fc" id="L42">        this.logRuntimeStartUpdate(sku);</span>
        try {
<span class="fc" id="L44">            productEntityUpdate = productRepository.save(productEntity);</span>
<span class="fc" id="L45">            this.logExternalSuccessUpdate(productEntityUpdate);</span>
<span class="fc" id="L46">        } catch (Exception e) {</span>
<span class="fc" id="L47">            this.logExternalFailedUpdate(sku,e);</span>
<span class="fc" id="L48">            throw e;</span>
<span class="fc" id="L49">        }</span>
<span class="fc" id="L50">        this.logRuntimeEndUpdate();</span>
<span class="fc" id="L51">        return productEntityUpdate;</span>
    }

    @Override
    public void deleteProduct(String sku) {
<span class="fc" id="L56">        this.logRuntimeStartDelete();</span>
        try {
<span class="fc" id="L58">            productRepository.deleteBySku(sku);</span>
<span class="fc" id="L59">            this.logExternalSuccessDelete(sku);</span>
<span class="fc" id="L60">        } catch (Exception e) {</span>
<span class="fc" id="L61">            this.logExternalFailedDelete(sku,e);</span>
<span class="fc" id="L62">            throw e;</span>
<span class="fc" id="L63">        }</span>
<span class="fc" id="L64">        this.logRuntimeEndDelete();</span>
<span class="fc" id="L65">    }</span>

    @Override
    public ProductEntity getProductBySku(String sku) {
<span class="fc" id="L69">        this.logRuntimeStartGet(sku);</span>
        ProductEntity productEntity;
        try {
<span class="fc" id="L72">            productEntity =  productRepository.findBySku(sku);</span>
<span class="fc" id="L73">            this.logExternalSuccessGet(productEntity);</span>
<span class="fc" id="L74">        } catch (Exception e) {</span>
<span class="fc" id="L75">            this.logExternalFailedGet(sku, e);</span>
<span class="fc" id="L76">            throw e;</span>
<span class="fc" id="L77">        }</span>
<span class="fc" id="L78">        this.logRuntimeEndGet();</span>
<span class="fc" id="L79">        return productEntity;</span>
    }

    @Override
    public List&lt;ProductEntity&gt; getAllProducts() {
<span class="fc" id="L84">        this.logRuntimeStartGetAll();</span>
        List&lt;ProductEntity&gt; productEntityList;
        try {
<span class="fc" id="L87">            productEntityList = productRepository.findAll();</span>
<span class="fc" id="L88">            this.logExternalSuccessGetAll();</span>
<span class="fc" id="L89">        } catch (Exception e) {</span>
<span class="fc" id="L90">            this.logExternalFailedGetAll(e);</span>
<span class="fc" id="L91">            throw e;</span>
<span class="fc" id="L92">        }</span>
<span class="fc" id="L93">        this.logRuntimeEndGetAll();</span>
<span class="fc" id="L94">        return productEntityList;</span>
    }

    @Override
    public Boolean existsBySku(String sku) {
<span class="fc" id="L99">        this.logRuntimeStartExist(sku);</span>
        boolean exists;
        try {
<span class="fc" id="L102">            exists = productRepository.existsBySku(sku);</span>
<span class="fc" id="L103">            this.logExternalSuccessExist(exists);</span>
<span class="fc" id="L104">        } catch (Exception e) {</span>
<span class="fc" id="L105">            this.logExternalFailedExist(sku,e);</span>
<span class="fc" id="L106">            throw e;</span>
<span class="fc" id="L107">        }</span>
<span class="fc" id="L108">        this.logRuntimeEndExist();</span>
<span class="fc" id="L109">        return exists;</span>
    }

    // ***************
    // **** logs  ****
    // ***************


    // ***************
    // **** exist ****
    // ***************

    public static final String EXIST_RUNTIME_START_MSG = &quot;Start checking Product exist with sku: {}&quot;;
    public static final String EXIST_RUNTIME_END_MSG = &quot;End checking Product exist&quot;;
    public static final String EXIST_EXTERNAL_SUCCESS_MSG = &quot;The result of exist Product is: {}&quot;;
    public static final String EXIST_EXTERNAL_FAILED_MSG = &quot;Error call to DB to check if the Product with sku: {} exist&quot;;

    protected void logRuntimeStartExist(final String sku) {
<span class="fc" id="L127">        logger.debug(EXIST_RUNTIME_START_MSG, sku);</span>
<span class="fc" id="L128">    }</span>

    protected void logRuntimeEndExist() {
<span class="fc" id="L131">        logger.debug(EXIST_RUNTIME_END_MSG);</span>
<span class="fc" id="L132">    }</span>

    protected void logExternalSuccessExist(final boolean exists) {
<span class="fc" id="L135">        logger.debug(EXIST_EXTERNAL_SUCCESS_MSG, exists);</span>
<span class="fc" id="L136">    }</span>

    protected void logExternalFailedExist(final String sku, final Exception e) {
<span class="fc" id="L139">        logger.error(EXIST_EXTERNAL_FAILED_MSG, sku, e);</span>
<span class="fc" id="L140">    }</span>


    // *****************
    // **** get all ****
    // *****************

    public static final String GET_ALL_RUNTIME_START_MSG = &quot;Start GET all data of Product in DB&quot;;
    public static final String GET_ALL_RUNTIME_END_MSG = &quot;End GET ALL data of Product in DB&quot;;
    public static final String GET_ALL_EXTERNAL_SUCCESS_MSG = &quot;The result of exist Products&quot;;
    public static final String GET_ALL_EXTERNAL_FAILED_MSG = &quot;Error call to GET ALL DB to data Products with error: &quot;;

    protected void logRuntimeStartGetAll() {
<span class="fc" id="L153">        logger.debug(GET_ALL_RUNTIME_START_MSG);</span>
<span class="fc" id="L154">    }</span>

    protected void logRuntimeEndGetAll() {
<span class="fc" id="L157">        logger.debug(GET_ALL_RUNTIME_END_MSG);</span>
<span class="fc" id="L158">    }</span>

    protected void logExternalSuccessGetAll() {
<span class="fc" id="L161">        logger.debug(GET_ALL_EXTERNAL_SUCCESS_MSG);</span>
<span class="fc" id="L162">    }</span>

    protected void logExternalFailedGetAll(final Exception e) {
<span class="fc" id="L165">        logger.error(GET_ALL_EXTERNAL_FAILED_MSG, e);</span>
<span class="fc" id="L166">    }</span>

    // *****************
    // **** get ********
    // *****************

    public static final String GET_RUNTIME_START_MSG = &quot;Start GET data of Product in DB whit SKU: {}&quot;;
    public static final String GET_RUNTIME_END_MSG = &quot;End GET data of Product in DB&quot;;
    public static final String GET_EXTERNAL_SUCCESS_MSG = &quot;The result of exist Product : {}&quot;;
    public static final String GET__EXTERNAL_FAILED_MSG = &quot;Error call to GET DB to data Products with error: {}&quot;;

    protected void logRuntimeStartGet(final String sku) {
<span class="fc" id="L178">        logger.debug(GET_RUNTIME_START_MSG, sku);</span>
<span class="fc" id="L179">    }</span>

    protected void logRuntimeEndGet() {
<span class="fc" id="L182">        logger.debug(GET_RUNTIME_END_MSG);</span>
<span class="fc" id="L183">    }</span>

    protected void logExternalSuccessGet(final Object product) {
<span class="fc" id="L186">        logger.debug(GET_EXTERNAL_SUCCESS_MSG, product);</span>
<span class="fc" id="L187">    }</span>

    protected void logExternalFailedGet(final String sku, final Exception e) {
<span class="fc" id="L190">        logger.error(GET__EXTERNAL_FAILED_MSG, sku, e);</span>
<span class="fc" id="L191">    }</span>
    // *****************
    // **** delete *****
    // *****************

    public static final String DELETE_RUNTIME_START_MSG = &quot;Start DELETE data of Product in DB&quot;;
    public static final String DELETE_RUNTIME_END_MSG = &quot;End DELETE data of Product in DB&quot;;
    public static final String DELETE_EXTERNAL_SUCCESS_MSG = &quot;The product with SKU: {} has been deleted successfully&quot;;
    public static final String DELETE_EXTERNAL_FAILED_MSG = &quot;Error call DELETE DB to data Products with error: {}&quot;;

    protected void logRuntimeStartDelete() {
<span class="fc" id="L202">        logger.debug(DELETE_RUNTIME_START_MSG);</span>
<span class="fc" id="L203">    }</span>

    protected void logRuntimeEndDelete() {
<span class="fc" id="L206">        logger.debug(DELETE_RUNTIME_END_MSG);</span>
<span class="fc" id="L207">    }</span>

    protected void logExternalSuccessDelete(final String sku) {
<span class="fc" id="L210">        logger.debug(DELETE_EXTERNAL_SUCCESS_MSG, sku);</span>
<span class="fc" id="L211">    }</span>

    protected void logExternalFailedDelete(final String sku, final Exception e) {
<span class="fc" id="L214">        logger.error(DELETE_EXTERNAL_FAILED_MSG, sku, e);</span>
<span class="fc" id="L215">    }</span>
    // *****************
    // **** update *****
    // *****************

    public static final String UPDATE_RUNTIME_START_MSG = &quot;Start UPDATE data of Product in DB whit SKU: {}&quot;;
    public static final String UPDATE_RUNTIME_END_MSG = &quot;End UPDATE data of Product in DB&quot;;
    public static final String UPDATE_EXTERNAL_SUCCESS_MSG = &quot;The product has been updated successfully: {}&quot;;
    public static final String UPDATE_EXTERNAL_FAILED_MSG = &quot;Error call UPDATE DB to data Products with error: {}&quot;;

    protected void logRuntimeStartUpdate(final String sku) {
<span class="fc" id="L226">        logger.debug(UPDATE_RUNTIME_START_MSG, sku);</span>
<span class="fc" id="L227">    }</span>

    protected void logRuntimeEndUpdate() {
<span class="fc" id="L230">        logger.debug(UPDATE_RUNTIME_END_MSG);</span>
<span class="fc" id="L231">    }</span>

    protected void logExternalSuccessUpdate(final Object product) {
<span class="fc" id="L234">        logger.debug(UPDATE_EXTERNAL_SUCCESS_MSG, product);</span>
<span class="fc" id="L235">    }</span>

    protected void logExternalFailedUpdate(final String sku, final Exception e) {
<span class="fc" id="L238">        logger.error(UPDATE_EXTERNAL_FAILED_MSG, sku, e);</span>
<span class="fc" id="L239">    }</span>

    // *****************
    // **** create *****
    // *****************

    public static final String CREATE_RUNTIME_START_MSG = &quot;Start CREATE data of Product in DB whit SKU: {}&quot;;
    public static final String CREATE_RUNTIME_END_MSG = &quot;End CREATE data of Product in DB&quot;;
    public static final String CREATE_EXTERNAL_SUCCESS_MSG = &quot;The product has been create successfully : {}&quot;;
    public static final String CREATE_EXTERNAL_FAILED_MSG = &quot;Error call CREATE DB to data Products with error: {}&quot;;

    protected void logRuntimeStartCreate(final String sku) {
<span class="fc" id="L251">        logger.debug(CREATE_RUNTIME_START_MSG, sku);</span>
<span class="fc" id="L252">    }</span>

    protected void logRuntimeEndCreate() {
<span class="fc" id="L255">        logger.debug(CREATE_RUNTIME_END_MSG);</span>
<span class="fc" id="L256">    }</span>

    protected void logExternalSuccessCreate(final Object product) {
<span class="fc" id="L259">        logger.debug(CREATE_EXTERNAL_SUCCESS_MSG, product);</span>
<span class="fc" id="L260">    }</span>

    protected void logExternalFailedCreate(final String sku, final Exception e) {
<span class="fc" id="L263">        logger.error(CREATE_EXTERNAL_FAILED_MSG, sku, e);</span>
<span class="fc" id="L264">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>